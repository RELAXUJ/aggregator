{# Price Comparison Table - Venue breakdown #}
{% if is_nav_only and token_entity %}
{# NAV-Only Token - Informational Card #}
<section class="bg-slate-900/70 border border-amber-700/50 rounded-2xl overflow-hidden">
    <div class="flex items-center justify-between px-4 py-3 border-b border-amber-700/30 bg-amber-900/20">
        <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-sm font-semibold text-amber-400">Informational Only</h2>
        </div>
        <span class="text-xs text-amber-500/70 bg-amber-500/10 px-2 py-1 rounded-full">NAV-Only Token</span>
    </div>
    
    <div class="p-6">
        <div class="text-center mb-6">
            <h3 class="text-2xl font-bold text-white mb-1">{{ token_entity.name }}</h3>
            <p class="text-sm text-slate-400">{{ token_entity.symbol }} &mdash; No Active Trading Pairs</p>
        </div>
        
        {# Status explanation box #}
        <div class="bg-slate-800/50 rounded-xl p-4 mb-4">
            <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-amber-500/70 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                <div>
                    <p class="text-sm text-slate-300 leading-relaxed">
                        This token does not have active spot trading pairs on major exchanges. 
                        It operates primarily through <strong class="text-slate-200">mint/redeem mechanisms</strong> 
                        or <strong class="text-slate-200">OTC transactions</strong> with the issuer.
                    </p>
                    {% if token_entity.symbol == "OUSG" %}
                    <p class="text-xs text-slate-500 mt-2">
                        Secondary market effectively inactive (24h volume ≈ 0). Exchanges suspended trading.
                    </p>
                    {% elif token_entity.symbol == "BENJI" %}
                    <p class="text-xs text-slate-500 mt-2">
                        Tokenized money market fund with P2P transfers. Focus on NAV, not orderbook.
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        {# Token metadata grid #}
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800/30 rounded-lg p-3">
                <span class="text-xs text-slate-500 uppercase tracking-wide">Issuer</span>
                <p class="text-sm text-white mt-1">{{ token_entity.issuer }}</p>
            </div>
            <div class="bg-slate-800/30 rounded-lg p-3">
                <span class="text-xs text-slate-500 uppercase tracking-wide">Category</span>
                <p class="text-sm text-white mt-1">{{ token_entity.category.value | replace("_", " ") | title }}</p>
            </div>
            {% if token_entity.chain %}
            <div class="bg-slate-800/30 rounded-lg p-3">
                <span class="text-xs text-slate-500 uppercase tracking-wide">Chain</span>
                <p class="text-sm text-white mt-1">{{ token_entity.chain }}</p>
            </div>
            {% endif %}
            {% if token_entity.contract_address %}
            <div class="bg-slate-800/30 rounded-lg p-3">
                <span class="text-xs text-slate-500 uppercase tracking-wide">Contract</span>
                <p class="text-sm text-white mt-1 font-mono truncate" title="{{ token_entity.contract_address }}">
                    {{ token_entity.contract_address[:10] }}...{{ token_entity.contract_address[-6:] }}
                </p>
            </div>
            {% endif %}
        </div>
        
        {# Why no spread data #}
        <div class="mt-6 pt-4 border-t border-slate-700/50">
            <div class="flex items-center justify-center gap-2 text-xs text-slate-500">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>No bid/ask spread available &mdash; visit issuer for trading/redemption</span>
            </div>
        </div>
    </div>
</section>
{% elif error_message %}
<div class="bg-red-900/20 border border-red-800 rounded-2xl p-6 text-center">
    <svg class="mx-auto h-10 w-10 text-red-500 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
    <p class="text-red-400">{{ error_message }}</p>
</div>
{% elif prices %}
{# Include KPI cards at the top of the partial for HTMX updates #}
{% include "partials/kpi_cards.html" %}

<section class="bg-slate-900/70 border border-slate-800 rounded-2xl overflow-hidden">
    <!-- Table Header -->
    <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800 bg-slate-900/50">
        <h2 class="text-sm font-semibold text-white">
            Order Book Snapshot — {{ prices.base_token_symbol }}
        </h2>
        <div class="flex items-center gap-3 text-xs text-slate-500">
            <span>Updated: {{ prices.last_updated.strftime('%H:%M:%S UTC') if prices.last_updated else 'N/A' }}</span>
            <span class="flex items-center gap-1">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                Auto-refresh: 10s
            </span>
        </div>
    </div>
    
    <!-- Price Table -->
    <div class="overflow-x-auto">
        <table id="venue-table" class="min-w-full text-sm">
            <thead class="bg-slate-900 border-b border-slate-800">
                <tr>
                    <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Venue</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Bid</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Ask</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Spread</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Volume 24h</th>
                    <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Updated</th>
                    <th class="text-center px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wide">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-800">
                {% if prices.venues %}
                    {% for venue in prices.venues %}
                    <tr class="hover:bg-slate-800/50 transition-colors duration-150
                               {% if venue.is_stale %}opacity-60{% endif %}">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-2">
                                <span class="font-medium text-white">{{ venue.venue_name }}</span>
                                {% if venue.is_stale %}
                                <span class="text-xs text-amber-500 bg-amber-500/10 px-2 py-0.5 rounded-full">Stale</span>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-4 py-3 text-right tabular-nums price-cell
                            {% if prices.best_prices.best_bid_price and venue.bid == prices.best_prices.best_bid_price %}
                            text-green-400 font-semibold bg-green-500/10
                            {% else %}text-slate-300{% endif %}">
                            ${{ "%.4f"|format(venue.bid) }}
                        </td>
                        <td class="px-4 py-3 text-right tabular-nums price-cell
                            {% if prices.best_prices.best_ask_price and venue.ask == prices.best_prices.best_ask_price %}
                            text-blue-400 font-semibold bg-blue-500/10
                            {% else %}text-slate-300{% endif %}">
                            ${{ "%.4f"|format(venue.ask) }}
                        </td>
                        <td class="px-4 py-3 text-right tabular-nums
                            {% if venue.spread_bps < 50 %}text-green-400
                            {% elif venue.spread_bps < 200 %}text-yellow-400
                            {% else %}text-red-400{% endif %}">
                            {{ "%.2f"|format(venue.spread_bps) }} bps
                        </td>
                        <td class="px-4 py-3 text-right tabular-nums text-slate-500">
                            {% if venue.volume_24h %}
                            ${{ "{:,.0f}".format(venue.volume_24h) }}
                            {% else %}
                            —
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-right text-xs text-slate-500">
                            {{ venue.timestamp.strftime('%H:%M:%S') if venue.timestamp else 'N/A' }}
                        </td>
                        <td class="px-4 py-3 text-center">
                            {% if venue.trade_url %}
                            <a href="{{ venue.trade_url }}" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="inline-flex items-center gap-1 text-xs text-indigo-400 hover:text-indigo-300 transition-colors">
                                Trade
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                            {% else %}
                            <span class="text-xs text-slate-600">—</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="px-4 py-8 text-center text-slate-500">
                            <svg class="mx-auto h-8 w-8 text-slate-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            No venue data available for this token
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Table Footer -->
    <div class="px-4 py-3 border-t border-slate-800 bg-slate-900/30 text-xs text-slate-500">
        <div class="flex flex-wrap items-center justify-between gap-2">
            <span>
                Showing {{ prices.venues|length }} venue{% if prices.venues|length != 1 %}s{% endif %}
                {% if prices.num_fresh_venues != prices.num_venues %}
                ({{ prices.num_fresh_venues }} fresh, {{ prices.num_venues - prices.num_fresh_venues }} stale)
                {% endif %}
            </span>
            <span>
                Token: {{ prices.base_token_name }} ({{ prices.base_token_symbol }}/{{ prices.quote_token_symbol }})
            </span>
        </div>
    </div>
</section>
{% else %}
<!-- Loading state / No data -->
<section class="bg-slate-900/70 border border-slate-800 rounded-2xl overflow-hidden">
    <div class="px-4 py-3 border-b border-slate-800 bg-slate-900/50">
        <div class="h-5 bg-slate-700 rounded w-48 animate-pulse"></div>
    </div>
    <div class="p-8 text-center">
        <svg class="mx-auto h-12 w-12 text-slate-600 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        <p class="mt-4 text-slate-500">Loading price data...</p>
    </div>
</section>
{% endif %}
